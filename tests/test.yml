---

- hosts: all
  pre_tasks:
    - apt: pkg={{ item }} update_cache=yes cache_valid_time=3600 state=present
      with_items:
        - vim
        - nginx
    - copy: src=vhost_nginx dest=/etc/nginx/sites-available/default
      notify: reload nginx
  handlers:
    - name: reload nginx
      service: name=nginx state=reloaded
  vars:
    backuppc_hosts:
      - hostname: localhost
        state: present
        include_files:
          - /root
          - /etc
          - /var
        exclude_files:
          - /var/lib/mysql
          - /var/log
          - /var/cache
        more:
          DumpPreUserCmd: '$sshPath -q -x -l root $host echo "I can dump mysql here!"'
  roles:
    - ../../
  post_tasks:
    - authorized_key: >
        user=root
        key="{{ lookup('file', './fetch/id_rsa.pub') }}"

